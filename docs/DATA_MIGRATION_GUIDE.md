# 真实数据迁移指南

## 🚀 进行真实数据迁移

### 准备工作

1. **确保用户已登录**
   - 打开应用
   - 在登录页面使用您的账户登录
   - 或者注册一个新账户

2. **检查AsyncStorage数据**
   - 确保AsyncStorage中有需要迁移的数据
   - 数据应该包括：recipes, favorites, comments, socialStats, userData

### 迁移步骤

#### 方法1：通过应用界面迁移（推荐）

1. **打开应用**并登录
2. **进入Profile页面**
   - 点击底部导航的 "Profile" 标签
3. **进入数据迁移页面**
   - 在菜单中找到 "Data Migration"
   - 点击进入数据迁移页面
4. **查看数据概览**
   - 页面会显示AsyncStorage中的数据统计
   - 确认有需要迁移的数据
5. **检查用户状态**
   - 确认显示 "已登录: [您的邮箱]"
   - 如果显示 "未登录"，请先返回登录
6. **开始迁移**
   - 点击 "开始迁移" 按钮
   - 确认迁移提示
   - 等待迁移完成
7. **查看迁移结果**
   - 迁移完成后会显示成功或失败消息
   - 查看迁移的详细信息

#### 方法2：通过控制台迁移

如果您想通过脚本进行批量迁移，可以使用 `test-real-migration.js` 脚本（但需要先认证）。

### 迁移内容

迁移会将以下数据从AsyncStorage迁移到Supabase：

1. **用户数据** (`userData`)
   - 用户名称
   - 用户邮箱
   - 用户头像URL

2. **菜谱数据** (`recipes`)
   - 菜谱标题、描述、图片
   - 烹饪时间、份数、厨具
   - 是否公开

3. **食材数据** (每个菜谱的ingredients)
   - 食材名称
   - 食材数量
   - 食材单位

4. **步骤数据** (每个菜谱的instructions)
   - 步骤编号
   - 步骤描述
   - 步骤图片（如果有）

5. **标签数据** (每个菜谱的tags)
   - 标签名称

6. **收藏数据** (`favorites`)
   - 用户收藏的菜谱列表

7. **评论数据** (`comments`)
   - 评论内容
   - 评论点赞数

8. **社交统计数据** (`socialStats`)
   - 每个菜谱的点赞、收藏、尝试、浏览数据

### 迁移后的验证

迁移完成后，您可以：

1. **查看Supabase数据库**
   - 访问 Supabase Dashboard
   - 检查各个表是否有新数据

2. **在应用中查看**
   - 查看您的菜谱列表
   - 检查收藏是否正常显示
   - 查看评论是否成功迁移

### 注意事项

⚠️ **重要提示**：

1. **必须先登录**
   - 数据迁移需要用户认证
   - 未登录状态下无法进行迁移

2. **数据归属**
   - 迁移的数据会关联到您当前登录的账户
   - 确保使用正确的账户登录

3. **一次性操作**
   - 建议迁移完成后清理AsyncStorage
   - 避免数据重复

4. **数据备份**
   - 迁移前建议备份AsyncStorage数据
   - 以防迁移过程中出现问题

5. **网络要求**
   - 确保网络连接稳定
   - WiFi环境下迁移更可靠

### 故障排除

#### 问题1：显示"未登录"
- **解决方案**：返回登录页面，使用您的账户登录

#### 问题2：显示"没有数据"
- **解决方案**：确认AsyncStorage中确实有数据，检查数据格式是否正确

#### 问题3：迁移失败
- **检查网络连接**：确保可以访问Supabase
- **检查用户认证**：确保登录状态有效
- **查看错误消息**：根据错误提示解决问题

#### 问题4：部分数据迁移失败
- **查看迁移结果**：了解哪些数据迁移成功，哪些失败
- **重新迁移**：可以针对失败的数据进行修复后重新迁移

### 迁移后的清理

迁移成功后，您可以：

1. **清理AsyncStorage**
   - 在数据迁移页面点击 "清理AsyncStorage"
   - 确认删除旧数据

2. **验证数据**
   - 在应用中查看迁移的数据
   - 确认一切正常

3. **继续使用**
   - 以后的数据将直接保存到Supabase
   - 不再使用AsyncStorage

---

**祝您迁移顺利！** 🎉
