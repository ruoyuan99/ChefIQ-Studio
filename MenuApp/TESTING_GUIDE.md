# 高优先级功能测试指南

## 🧪 测试前准备

### 1. 数据库迁移

**重要：** 在执行测试前，必须先执行数据库迁移脚本。

**步骤：**
1. 登录 Supabase Dashboard: https://supabase.com/dashboard
2. 选择你的项目
3. 进入 **SQL Editor**
4. 打开 `database/add_bio_and_points_fields.sql`
5. 复制脚本内容
6. 在 SQL Editor 中执行脚本
7. 确认执行成功（应该显示 "Success. No rows returned"）

### 2. 检查应用状态

```bash
cd MenuApp
npm start
```

---

## 📋 测试清单

### 测试 1: 用户资料编辑功能

#### 1.1 测试头像上传（拍照）
- [ ] 进入 Profile 页面
- [ ] 点击 "Edit Profile" 按钮
- [ ] 点击头像区域
- [ ] 选择 "Take Photo"
- [ ] 拍照
- [ ] 确认头像更新
- [ ] 点击 "Save"
- [ ] 验证头像在 Profile 页面显示

#### 1.2 测试头像上传（从相册）
- [ ] 进入 Edit Profile 页面
- [ ] 点击头像区域
- [ ] 选择 "Choose from Library"
- [ ] 选择一张图片
- [ ] 确认头像更新
- [ ] 点击 "Save"
- [ ] 验证头像保存成功

#### 1.3 测试头像移除
- [ ] 进入 Edit Profile 页面
- [ ] 点击头像区域
- [ ] 选择 "Remove"
- [ ] 确认头像被移除
- [ ] 点击 "Save"
- [ ] 验证头像被移除

#### 1.4 测试姓名编辑
- [ ] 进入 Edit Profile 页面
- [ ] 修改姓名字段
- [ ] 点击 "Save"
- [ ] 验证姓名在 Profile 页面更新

#### 1.5 测试简介编辑
- [ ] 进入 Edit Profile 页面
- [ ] 修改简介字段（bio）
- [ ] 点击 "Save"
- [ ] 验证简介保存成功

#### 1.6 验证数据同步
- [ ] 编辑资料后
- [ ] 退出应用并重新登录
- [ ] 验证资料数据仍然存在

---

### 测试 2: 积分系统

#### 2.1 测试创建食谱积分
- [ ] 创建一个新食谱
- [ ] 发布食谱
- [ ] 进入 Profile 页面
- [ ] 验证积分增加 50 分
- [ ] 检查积分等级是否更新

#### 2.2 测试点赞积分
- [ ] 进入任意食谱详情页面
- [ ] 点击 "Like" 按钮
- [ ] 进入 Profile 页面
- [ ] 验证积分增加 5 分

#### 2.3 测试收藏积分
- [ ] 进入任意食谱详情页面
- [ ] 点击 "Favorite" 按钮
- [ ] 进入 Profile 页面
- [ ] 验证积分增加 10 分

#### 2.4 测试分享积分
- [ ] 进入任意食谱详情页面
- [ ] 点击分享按钮
- [ ] 完成分享操作
- [ ] 进入 Profile 页面
- [ ] 验证积分增加 15 分

#### 2.5 测试尝试食谱积分
- [ ] 进入任意食谱详情页面
- [ ] 点击 "Try it!" 按钮
- [ ] 进入 Profile 页面
- [ ] 验证积分增加 20 分

#### 2.6 测试评论积分
- [ ] 进入任意食谱详情页面
- [ ] 添加一条评论
- [ ] 进入 Profile 页面
- [ ] 验证积分增加 8 分

#### 2.7 验证积分同步
- [ ] 执行多个积分操作
- [ ] 退出应用并重新登录
- [ ] 验证积分数据仍然存在

---

### 测试 3: 评论同步

#### 3.1 测试添加评论
- [ ] 进入任意食谱详情页面
- [ ] 滚动到底部评论区域
- [ ] 输入评论内容
- [ ] 点击发送按钮
- [ ] 验证评论显示在列表中

#### 3.2 测试评论同步
- [ ] 添加一条评论
- [ ] 退出应用并重新登录
- [ ] 进入同一食谱详情页面
- [ ] 验证评论仍然存在

#### 3.3 测试评论显示
- [ ] 进入有评论的食谱详情页面
- [ ] 验证评论显示作者信息
- [ ] 验证评论显示时间
- [ ] 验证评论内容正确

#### 3.4 测试评论点赞
- [ ] 进入有评论的食谱详情页面
- [ ] 点击评论的点赞按钮
- [ ] 验证点赞数增加

---

### 测试 4: 数据同步验证

#### 4.1 验证用户资料同步
- [ ] 编辑用户资料
- [ ] 检查 Supabase Dashboard 中的 users 表
- [ ] 验证 bio 字段已更新
- [ ] 验证 avatar_url 已更新

#### 4.2 验证积分同步
- [ ] 执行积分操作
- [ ] 检查 Supabase Dashboard 中的 users 表
- [ ] 验证 total_points 字段已更新
- [ ] 检查 user_points 表
- [ ] 验证积分历史记录已创建

#### 4.3 验证评论同步
- [ ] 添加评论
- [ ] 检查 Supabase Dashboard 中的 comments 表
- [ ] 验证评论已创建
- [ ] 验证 user_id 和 recipe_id 正确

---

## 🐛 常见问题排查

### 问题 1: 头像上传失败
**可能原因：**
- Supabase Storage 权限未设置
- 网络连接问题

**解决方法：**
1. 检查 Supabase Storage 的 RLS 策略
2. 确保 `recipe-images` bucket 存在
3. 检查网络连接

### 问题 2: 积分不同步
**可能原因：**
- 数据库迁移脚本未执行
- user_points 表不存在

**解决方法：**
1. 执行 `add_bio_and_points_fields.sql` 脚本
2. 检查 users 表是否有 total_points 字段
3. 检查 user_points 表是否存在

### 问题 3: 评论不显示
**可能原因：**
- RLS 策略未正确设置
- 评论未同步到 Supabase

**解决方法：**
1. 检查 comments 表的 RLS 策略
2. 检查 Supabase Dashboard 中的 comments 表
3. 查看应用控制台日志

### 问题 4: 用户资料不更新
**可能原因：**
- bio 字段不存在
- RLS 策略限制

**解决方法：**
1. 执行数据库迁移脚本
2. 检查 users 表的 RLS 策略
3. 验证用户已登录

---

## 📊 测试结果记录

### 测试日期：__________

#### 用户资料编辑
- 头像上传（拍照）：✅ / ❌
- 头像上传（相册）：✅ / ❌
- 头像移除：✅ / ❌
- 姓名编辑：✅ / ❌
- 简介编辑：✅ / ❌
- 数据同步：✅ / ❌

#### 积分系统
- 创建食谱积分：✅ / ❌
- 点赞积分：✅ / ❌
- 收藏积分：✅ / ❌
- 分享积分：✅ / ❌
- 尝试食谱积分：✅ / ❌
- 评论积分：✅ / ❌
- 积分同步：✅ / ❌

#### 评论系统
- 添加评论：✅ / ❌
- 评论同步：✅ / ❌
- 评论显示：✅ / ❌
- 评论点赞：✅ / ❌

#### 数据同步
- 用户资料同步：✅ / ❌
- 积分同步：✅ / ❌
- 评论同步：✅ / ❌

---

## 🎯 下一步

1. **完成所有测试**
2. **记录测试结果**
3. **修复发现的问题**
4. **进行回归测试**

---

**测试指南版本：** 1.0
**最后更新：** 2025-01-XX

