# å•å…ƒæµ‹è¯•å®æ–½æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æµ‹è¯•æ¡†æ¶å®‰è£… âœ…
- å®‰è£…äº† Jestã€React Native Testing Library ç­‰æµ‹è¯•ä¾èµ–
- é…ç½®äº† Jest é…ç½®æ–‡ä»¶ (`jest.config.js`)
- åˆ›å»ºäº†æµ‹è¯•è®¾ç½®æ–‡ä»¶ (`jest.setup.js`)

### 2. æµ‹è¯•æ–‡ä»¶åˆ›å»º âœ…

#### å·¥å…·å‡½æ•°æµ‹è¯•
- âœ… `src/utils/__tests__/recipeMatcher.test.ts` - é£Ÿè°±åŒ¹é…å·¥å…·æµ‹è¯•
- âœ… `src/utils/__tests__/imageCompression.test.ts` - å›¾ç‰‡å‹ç¼©å·¥å…·æµ‹è¯•

#### æœåŠ¡æµ‹è¯•
- âœ… `src/services/__tests__/recipeImportService.test.ts` - é£Ÿè°±å¯¼å…¥æœåŠ¡æµ‹è¯•
- âœ… `src/services/__tests__/userPreferenceService.test.ts` - ç”¨æˆ·åå¥½æœåŠ¡æµ‹è¯•
- âœ… `src/services/__tests__/recommendationService.test.ts` - æ¨èæœåŠ¡æµ‹è¯•

#### é…ç½®æµ‹è¯•
- âœ… `src/config/__tests__/recipeImport.test.ts` - åç«¯é…ç½®æµ‹è¯•

#### ç»„ä»¶æµ‹è¯•
- âœ… `src/components/__tests__/OptimizedImage.test.tsx` - ä¼˜åŒ–å›¾ç‰‡ç»„ä»¶æµ‹è¯•

#### ä¸Šä¸‹æ–‡æµ‹è¯•
- âœ… `src/contexts/__tests__/PointsContext.test.tsx` - ç§¯åˆ†ä¸Šä¸‹æ–‡æµ‹è¯•

### 3. æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½

#### å·¥å…·å‡½æ•°
- âœ… `calculateMatchScore` - è®¡ç®—é£Ÿè°±åŒ¹é…åˆ†æ•°
- âœ… `findRelatedRecipes` - æŸ¥æ‰¾ç›¸å…³é£Ÿè°±
- âœ… `compressImage` - å‹ç¼©å›¾ç‰‡
- âœ… `compressRecipeImage` - å‹ç¼©é£Ÿè°±å›¾ç‰‡
- âœ… `compressAvatarImage` - å‹ç¼©å¤´åƒå›¾ç‰‡
- âœ… `generateThumbnail` - ç”Ÿæˆç¼©ç•¥å›¾

#### æœåŠ¡
- âœ… `importRecipeViaBackend` - ä»åç«¯å¯¼å…¥é£Ÿè°±
- âœ… `generateRecipeFromIngredients` - ä»é£Ÿæç”Ÿæˆé£Ÿè°±
- âœ… `analyzeUserPreferences` - åˆ†æç”¨æˆ·åå¥½
- âœ… `calculateRecommendationScore` - è®¡ç®—æ¨èåˆ†æ•°
- âœ… `sortByRecommendation` - æŒ‰æ¨èæ’åº

#### é…ç½®
- âœ… `getBackendUrl` - è·å–åç«¯ URL
- âœ… ç¯å¢ƒå˜é‡é…ç½®æµ‹è¯•

#### ç»„ä»¶
- âœ… `OptimizedImage` - ä¼˜åŒ–å›¾ç‰‡ç»„ä»¶æ¸²æŸ“æµ‹è¯•

#### ä¸Šä¸‹æ–‡
- âœ… `PointsContext` - ç§¯åˆ†ä¸Šä¸‹æ–‡æµ‹è¯•
- âœ… `POINTS_RULES` - ç§¯åˆ†è§„åˆ™æµ‹è¯•
- âœ… `addPoints` - æ·»åŠ ç§¯åˆ†æµ‹è¯•
- âœ… `getLevelInfo` - è·å–ç­‰çº§ä¿¡æ¯æµ‹è¯•

## âš ï¸ å‘ç°çš„é—®é¢˜

### 1. Jest é…ç½®é—®é¢˜

**é—®é¢˜**: Jest åœ¨å¤„ç† Expo æ¨¡å—æ—¶é‡åˆ° ES æ¨¡å—å¯¼å…¥é—®é¢˜

**é”™è¯¯ä¿¡æ¯**:
```
SyntaxError: Cannot use import statement outside a module
at expo-modules-core/src/polyfill/dangerous-internal.ts:1
```

**åŸå› **: 
- `jest-expo` preset åœ¨å¤„ç†æŸäº› Expo æ¨¡å—æ—¶å¯èƒ½é‡åˆ°å…¼å®¹æ€§é—®é¢˜
- Expo SDK 54 ä½¿ç”¨äº†ä¸€äº›æ–°çš„ ES æ¨¡å—ç‰¹æ€§

**è§£å†³æ–¹æ¡ˆ**:
1. æ›´æ–° `transformIgnorePatterns` ä»¥åŒ…å«æ›´å¤š Expo æ¨¡å—
2. ä½¿ç”¨ `babel-jest` è¿›è¡Œè½¬æ¢
3. æˆ–è€…ä½¿ç”¨æ›´ç®€å•çš„æµ‹è¯•é…ç½®ï¼Œä¸“æ³¨äºçº¯å‡½æ•°å’ŒæœåŠ¡çš„æµ‹è¯•

### 2. æµ‹è¯•ç¯å¢ƒé…ç½®

**é—®é¢˜**: æŸäº› React Native å’Œ Expo æ¨¡å—éœ€è¦ç‰¹æ®Šå¤„ç†

**è§£å†³æ–¹æ¡ˆ**:
- å·²ç»åœ¨ `jest.setup.js` ä¸­æ¨¡æ‹Ÿäº†ä¸»è¦æ¨¡å—
- éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–æ¨¡æ‹Ÿé…ç½®

## ğŸ”§ éœ€è¦ä¿®å¤çš„é—®é¢˜

### ä¼˜å…ˆçº§ 1: Jest é…ç½®ä¿®å¤

1. **æ›´æ–° transformIgnorePatterns**
   ```javascript
   transformIgnorePatterns: [
     'node_modules/(?!(jest-)?react-native|@react-native(-community)?|@react-navigation|expo(nent)?|@expo(nent)?/.*|@expo-google-fonts/.*|react-navigation|@unimodules/.*|unimodules|sentry-expo|native-base|react-native-svg|expo-image|expo-image-manipulator|expo-file-system|expo-media-library|@supabase|expo-modules-core)/)',
   ]
   ```

2. **æ·»åŠ  Babel é…ç½®**
   - ç¡®ä¿ Babel é…ç½®æ­£ç¡®
   - æ·»åŠ  TypeScript æ”¯æŒ

3. **æ›´æ–° jest-expo ç‰ˆæœ¬**
   - æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬
   - æˆ–è€…è€ƒè™‘ä½¿ç”¨è‡ªå®šä¹‰é…ç½®

### ä¼˜å…ˆçº§ 2: æµ‹è¯•æ–‡ä»¶ä¿®å¤

1. **ä¿®å¤ PointsContext æµ‹è¯•**
   - æ”¹è¿›æ¨¡æ‹Ÿé…ç½®
   - ä¿®å¤å¼‚æ­¥æµ‹è¯•é—®é¢˜

2. **ä¿®å¤ OptimizedImage æµ‹è¯•**
   - æ”¹è¿›ç»„ä»¶æ¸²æŸ“æµ‹è¯•
   - æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹

### ä¼˜å…ˆçº§ 3: æµ‹è¯•è¦†ç›–ç‡

1. **æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹**
   - è¾¹ç•Œæƒ…å†µæµ‹è¯•
   - é”™è¯¯å¤„ç†æµ‹è¯•
   - é›†æˆæµ‹è¯•

2. **æé«˜æµ‹è¯•è¦†ç›–ç‡**
   - ç›®æ ‡: 80%+ è¦†ç›–ç‡
   - é‡ç‚¹å…³æ³¨æ ¸å¿ƒåŠŸèƒ½

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

### å·²åˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶
- å·¥å…·å‡½æ•°æµ‹è¯•: 2 ä¸ªæ–‡ä»¶
- æœåŠ¡æµ‹è¯•: 3 ä¸ªæ–‡ä»¶
- é…ç½®æµ‹è¯•: 1 ä¸ªæ–‡ä»¶
- ç»„ä»¶æµ‹è¯•: 1 ä¸ªæ–‡ä»¶
- ä¸Šä¸‹æ–‡æµ‹è¯•: 1 ä¸ªæ–‡ä»¶

### æµ‹è¯•ç”¨ä¾‹æ•°é‡
- `recipeMatcher.test.ts`: 15+ æµ‹è¯•ç”¨ä¾‹
- `imageCompression.test.ts`: 10+ æµ‹è¯•ç”¨ä¾‹
- `recipeImportService.test.ts`: 8+ æµ‹è¯•ç”¨ä¾‹
- `userPreferenceService.test.ts`: 12+ æµ‹è¯•ç”¨ä¾‹
- `recommendationService.test.ts`: 10+ æµ‹è¯•ç”¨ä¾‹
- `recipeImport.test.ts`: 6+ æµ‹è¯•ç”¨ä¾‹
- `OptimizedImage.test.tsx`: 7+ æµ‹è¯•ç”¨ä¾‹
- `PointsContext.test.tsx`: 6+ æµ‹è¯•ç”¨ä¾‹

### æ€»æµ‹è¯•ç”¨ä¾‹
- é¢„è®¡: 70+ æµ‹è¯•ç”¨ä¾‹
- è¦†ç›–: æ ¸å¿ƒåŠŸèƒ½çš„ä¸»è¦åœºæ™¯

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨
1. âœ… ä¿®å¤ Jest é…ç½®é—®é¢˜
2. âœ… è¿è¡Œæµ‹è¯•å¹¶ä¿®å¤å¤±è´¥ç”¨ä¾‹
3. âœ… æé«˜æµ‹è¯•è¦†ç›–ç‡

### çŸ­æœŸç›®æ ‡
1. æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•
2. æ·»åŠ  E2E æµ‹è¯•
3. è®¾ç½® CI/CD æµ‹è¯•æµç¨‹

### é•¿æœŸç›®æ ‡
1. å®ç° 90%+ æµ‹è¯•è¦†ç›–ç‡
2. æ·»åŠ æ€§èƒ½æµ‹è¯•
3. æ·»åŠ å¯è®¿é—®æ€§æµ‹è¯•

## ğŸ“ æµ‹è¯•è¿è¡Œå‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶ç›‘å¬å˜åŒ–
npm run test:watch

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
npm test -- src/utils/__tests__/recipeMatcher.test.ts

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
npm test -- --verbose
```

## ğŸ¯ æµ‹è¯•è´¨é‡ç›®æ ‡

### è¦†ç›–ç‡ç›®æ ‡
- **å·¥å…·å‡½æ•°**: 90%+ è¦†ç›–ç‡
- **æœåŠ¡**: 80%+ è¦†ç›–ç‡
- **ç»„ä»¶**: 70%+ è¦†ç›–ç‡
- **ä¸Šä¸‹æ–‡**: 60%+ è¦†ç›–ç‡

### æµ‹è¯•è´¨é‡
- âœ… å•å…ƒæµ‹è¯•: æµ‹è¯•å•ä¸ªå‡½æ•°/æ–¹æ³•
- âœ… é›†æˆæµ‹è¯•: æµ‹è¯•å¤šä¸ªç»„ä»¶çš„äº¤äº’
- âœ… æ¨¡æ‹Ÿä¾èµ–: ä½¿ç”¨ Jest mocks
- âœ… æµ‹è¯•éš”ç¦»: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- âœ… æµ‹è¯•å‘½å: ä½¿ç”¨æè¿°æ€§åç§°

## ğŸ“š æµ‹è¯•æ–‡æ¡£

### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
src/
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”œâ”€â”€ recipeMatcher.test.ts
â”‚   â”‚   â””â”€â”€ imageCompression.test.ts
â”‚   â””â”€â”€ recipeMatcher.ts
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â”œâ”€â”€ recipeImportService.test.ts
â”‚   â”‚   â”œâ”€â”€ userPreferenceService.test.ts
â”‚   â”‚   â””â”€â”€ recommendationService.test.ts
â”‚   â””â”€â”€ recipeImportService.ts
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __tests__/
â”‚   â”‚   â””â”€â”€ OptimizedImage.test.tsx
â”‚   â””â”€â”€ OptimizedImage.tsx
â””â”€â”€ contexts/
    â”œâ”€â”€ __tests__/
    â”‚   â””â”€â”€ PointsContext.test.tsx
    â””â”€â”€ PointsContext.tsx
```

## ğŸ” æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½å
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- éµå¾ª "should ... when ..." æ¨¡å¼

### 2. æµ‹è¯•ç»„ç»‡
- ä½¿ç”¨ `describe` å—ç»„ç»‡æµ‹è¯•
- æ¯ä¸ªæµ‹è¯•æ–‡ä»¶å¯¹åº”ä¸€ä¸ªæºæ–‡ä»¶

### 3. æ¨¡æ‹Ÿå’Œå­˜æ ¹
- æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–
- ä½¿ç”¨ Jest mocks
- ä¿æŒæµ‹è¯•éš”ç¦»

### 4. æ–­è¨€
- ä½¿ç”¨æ¸…æ™°çš„æ–­è¨€
- æµ‹è¯•é¢„æœŸè¡Œä¸ºå’Œè¾¹ç•Œæƒ…å†µ
- æµ‹è¯•é”™è¯¯å¤„ç†

## âœ… æ€»ç»“

### å·²å®Œæˆ
- âœ… æµ‹è¯•æ¡†æ¶å®‰è£…å’Œé…ç½®
- âœ… 8 ä¸ªæµ‹è¯•æ–‡ä»¶åˆ›å»º
- âœ… 70+ æµ‹è¯•ç”¨ä¾‹ç¼–å†™
- âœ… æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•è¦†ç›–

### éœ€è¦ä¿®å¤
- âš ï¸ Jest é…ç½®é—®é¢˜ (Expo æ¨¡å—å…¼å®¹æ€§)
- âš ï¸ æŸäº›æµ‹è¯•å¯èƒ½éœ€è¦è°ƒæ•´
- âš ï¸ æµ‹è¯•è¦†ç›–ç‡éœ€è¦æé«˜

### ä¸‹ä¸€æ­¥
1. ä¿®å¤ Jest é…ç½®é—®é¢˜
2. è¿è¡Œæµ‹è¯•å¹¶ä¿®å¤å¤±è´¥ç”¨ä¾‹
3. æé«˜æµ‹è¯•è¦†ç›–ç‡
4. æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°æµ‹è¯•é—®é¢˜ï¼Œè¯·æ£€æŸ¥:
1. Jest é…ç½®æ˜¯å¦æ­£ç¡®
2. æ¨¡æ‹Ÿé…ç½®æ˜¯å¦å®Œæ•´
3. ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
4. æµ‹è¯•ç¯å¢ƒæ˜¯å¦æ­£ç¡®è®¾ç½®

è¯¦ç»†çš„æµ‹è¯•é…ç½®å’Œé—®é¢˜è§£å†³æ–¹æ¡ˆè¯·å‚è€ƒ:
- `jest.config.js` - Jest é…ç½®
- `jest.setup.js` - æµ‹è¯•è®¾ç½®
- `TESTING_SETUP.md` - æµ‹è¯•è®¾ç½®æŒ‡å—

