# GPT-4o-mini 测试指南

## 配置更改

已更改 `.env` 文件中的模型配置：
```bash
OPENAI_MODEL_RECIPE=gpt-4o-mini
```

## 测试步骤

### 1. 基本功能测试

在应用中测试生成食谱功能，使用不同的食材组合：

**测试用例 1: 简单食材**
- 食材: Chicken, Tomato, Garlic
- Cookware: Air Fryer
- Cooking Time: Quick
- Servings: 4

**测试用例 2: 复杂食材**
- 食材: Tofu, Coconut Milk, Curry Powder, Onion, Carrot
- Cookware: Slow Cooker
- Cooking Time: Medium
- Servings: 6
- Cuisine: Thai
- Dietary: Vegetarian

**测试用例 3: 多样化食材**
- 食材: Salmon, Lemon, Basil, Olive Oil, Rice
- Cookware: Oven
- Cooking Time: Quick
- Servings: 2

### 2. 质量评估指标

#### A. 标题多样性
- ✅ **优秀**: 三个标题完全不同，包含具体的菜类型（如 "Tacos", "Curry", "Soup"）
- ⚠️ **一般**: 标题有一定差异，但可能使用通用词汇
- ❌ **差**: 标题重复或使用 "Supper", "Feast", "Showcase" 等通用后缀

#### B. 食谱详细程度
- ✅ **优秀**: 每个食谱有 5+ 个详细指令，包含具体时间和温度
- ⚠️ **一般**: 每个食谱有 3-4 个指令，但可能不够详细
- ❌ **差**: 指令少于 3 个，或过于简单

#### C. 真实性
- ✅ **优秀**: 食谱看起来像真实食谱，有合理的食材组合和烹饪方法
- ⚠️ **一般**: 食谱基本合理，但可能有些不够自然
- ❌ **差**: 食谱看起来不真实，食材组合不合理

#### D. 规则遵循
- ✅ **优秀**: 严格遵守所有用户要求（cookware, cooking time, servings, cuisine, dietary restrictions）
- ⚠️ **一般**: 基本遵循要求，但可能有一些偏差
- ❌ **差**: 明显违反用户要求

#### E. 多样性
- ✅ **优秀**: 三个食谱在多个维度上完全不同（食材、菜类型、风味、烹饪方法）
- ⚠️ **一般**: 三个食谱有一定差异，但可能有一些相似性
- ❌ **差**: 三个食谱过于相似

### 3. 成本监控

查看服务器日志中的 token 使用情况：
```bash
cd "/Users/ruoyuangao/Desktop/Chef iQ RN/MenuApp/server"
tail -f server.log | grep -E "token usage|Token|💰"
```

预期 token 消耗（使用 GPT-4o-mini）:
- Stage 1: ~1900-2600 tokens
- Stage 2: ~4100-5600 tokens
- YouTube: ~950-1350 tokens
- **总计**: ~8000 tokens
- **成本**: ~$0.0039 per query

### 4. 对比测试

如果可能，保留一些使用 GPT-4o 生成的食谱作为对比，评估质量差异。

## 测试结果记录

### 测试日期: ___________

#### 测试用例 1
- **标题多样性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **食谱详细程度**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **真实性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **规则遵循**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **多样性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **Token 消耗**: __________ tokens
- **成本**: $__________
- **备注**: 
  _________________________________________________
  _________________________________________________

#### 测试用例 2
- **标题多样性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **食谱详细程度**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **真实性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **规则遵循**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **多样性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **Token 消耗**: __________ tokens
- **成本**: $__________
- **备注**: 
  _________________________________________________
  _________________________________________________

#### 测试用例 3
- **标题多样性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **食谱详细程度**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **真实性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **规则遵循**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **多样性**: ⬜ 优秀 ⬜ 一般 ⬜ 差
- **Token 消耗**: __________ tokens
- **成本**: $__________
- **备注**: 
  _________________________________________________
  _________________________________________________

## 结论

### 质量评估
- ⬜ GPT-4o-mini 质量可接受，可以继续使用
- ⬜ GPT-4o-mini 质量不够，需要改回 GPT-4o
- ⬜ 考虑混合方案（Stage 1 用 mini，Stage 2 用 gpt-4o）

### 成本节省
- **当前成本** (GPT-4o): $0.057 per query
- **新成本** (GPT-4o-mini): $0.0039 per query
- **节省**: 93% ($0.0531 per query)

### 下一步行动
1. ⬜ 继续使用 GPT-4o-mini
2. ⬜ 改回 GPT-4o
3. ⬜ 实施混合方案
4. ⬜ 进一步优化 prompt

## 常见问题

### Q: 如果标题仍然出现 "Supper", "Feast", "Showcase"？
A: 这可能是因为 prompt 不够明确，或者 mini 模型的理解能力有限。可以尝试：
1. 进一步优化 prompt，更明确地禁止这些词汇
2. 考虑使用混合方案（Stage 2 使用 GPT-4o）
3. 在后处理中添加标题验证和替换逻辑

### Q: 如果食谱质量明显下降？
A: 考虑：
1. 改回 GPT-4o（如果质量要求高）
2. 使用混合方案（Stage 1 用 mini，Stage 2 用 gpt-4o）
3. 优化 prompt，使其更适合 mini 模型

### Q: 如何查看实际的 token 消耗？
A: 查看服务器日志：
```bash
tail -f server.log | grep -E "token usage|Token|💰"
```

或查看 `aiTokenLogger.js` 生成的日志。

