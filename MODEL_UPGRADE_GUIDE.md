# 模型升级指南 - 提升食谱生成质量

## 当前配置

### 之前使用的模型
- **模型**: `gpt-4o-mini`
- **特点**: 便宜、快速，但质量一般
- **问题**: 生成的食谱可能过于简单、缺乏创意，或者只是随机组合食材

### 升级后的模型
- **模型**: `gpt-4o` (默认)
- **特点**: 更强大、更智能，生成质量显著提升
- **优势**: 
  - 更好地理解烹饪技巧和风味搭配
  - 生成更真实、实用的食谱
  - 更好的创造性和多样性
  - 更准确的步骤说明和时间控制

## 模型对比

| 特性 | gpt-4o-mini | gpt-4o |
|------|------------|--------|
| **成本** | $0.15 / 1M input tokens | $2.50 / 1M input tokens |
| **速度** | 快 | 中等 |
| **质量** | 一般 | 优秀 |
| **创意** | 有限 | 丰富 |
| **准确性** | 中等 | 高 |
| **适用场景** | 简单任务、测试 | 生产环境、高质量内容 |

## 成本估算

### 食谱生成API调用
- **输入**: 约 2000-3000 tokens (prompt + system message)
- **输出**: 约 2000-4000 tokens (3个完整食谱)

### gpt-4o-mini 成本
- 输入: 2000 tokens × $0.15 / 1M = $0.0003
- 输出: 3000 tokens × $0.60 / 1M = $0.0018
- **总计**: 约 $0.002 per recipe generation

### gpt-4o 成本
- 输入: 2000 tokens × $2.50 / 1M = $0.005
- 输出: 3000 tokens × $10.00 / 1M = $0.03
- **总计**: 约 $0.035 per recipe generation

### 成本差异
- **gpt-4o 比 gpt-4o-mini 贵约 17.5倍**
- 但如果生成质量显著提升，这个成本是值得的

## 配置选项

### 方式1: 使用环境变量 (推荐)
在 `.env` 文件中添加：
```bash
# 食谱生成专用模型 (推荐使用 gpt-4o)
OPENAI_MODEL_RECIPE=gpt-4o

# 或者继续使用 gpt-4o-mini (如果预算有限)
# OPENAI_MODEL_RECIPE=gpt-4o-mini
```

### 方式2: 修改代码默认值
代码中已经默认使用 `gpt-4o`：
```javascript
const modelForRecipeGeneration = process.env.OPENAI_MODEL_RECIPE || 'gpt-4o';
```

### 方式3: 混合使用 (高级)
- 食谱生成: 使用 `gpt-4o` (高质量)
- YouTube搜索优化: 使用 `gpt-4o-mini` (成本较低)
- 其他功能: 使用 `gpt-4o-mini` (成本较低)

## 其他优化建议

### 1. 调整 Temperature 参数
- **当前**: 0.8
- **建议**: 
  - 如果结果太随机: 降低到 0.7
  - 如果结果太保守: 提高到 0.85
  - 最佳范围: 0.75 - 0.85

### 2. 优化 Prompt
- 已经添加了详细的示例和指导
- 可以进一步细化特定菜系的要求
- 可以添加更多真实食谱的参考

### 3. 后处理优化
- 验证生成的食谱质量
- 检查食材搭配是否合理
- 验证步骤是否完整
- 添加质量评分机制

### 4. 缓存机制
- 缓存常见食材组合的食谱
- 减少重复API调用
- 降低成本

## 测试建议

### 1. 对比测试
生成相同的食材组合，对比两个模型的效果：
```bash
# 使用 gpt-4o-mini
OPENAI_MODEL_RECIPE=gpt-4o-mini

# 使用 gpt-4o
OPENAI_MODEL_RECIPE=gpt-4o
```

### 2. 质量评估
检查以下方面：
- 食谱是否真实、实用？
- 步骤是否详细、清晰？
- 食材搭配是否合理？
- 三个食谱是否显著不同？
- 是否符合用户要求？

### 3. 成本监控
- 监控API调用次数
- 跟踪token使用量
- 计算每月成本
- 设置预算警报

## 预期改进

使用 `gpt-4o` 后，您应该看到：

1. **更真实的食谱**
   - 基于真实的烹饪技巧
   - 合理的食材搭配
   - 完整的步骤说明

2. **更好的创意**
   - 三个食谱显著不同
   - 多样化的风味和技巧
   - 创新的组合方式

3. **更详细的说明**
   - 具体的时间和温度
   - 清晰的准备步骤
   - 实用的烹饪技巧

4. **更好的结构**
   - 清晰的标题和描述
   - 完整的食材列表
   - 详细的步骤说明

## 下一步

1. **更新 .env 文件**
   ```bash
   OPENAI_MODEL_RECIPE=gpt-4o
   ```

2. **重启服务器**
   ```bash
   cd MenuApp/server
   npm start
   ```

3. **测试生成**
   - 使用不同的食材组合
   - 测试不同的菜系和饮食限制
   - 评估生成质量

4. **监控成本**
   - 跟踪API使用情况
   - 评估是否需要进一步优化

## 故障排除

### 问题1: API错误
- 检查API key是否有效
- 确认账户有足够余额
- 检查rate limit

### 问题2: 成本过高
- 考虑使用 `gpt-4o-mini` 进行测试
- 实现缓存机制
- 优化prompt减少token使用

### 问题3: 质量仍然不佳
- 进一步优化prompt
- 调整temperature参数
- 添加更多示例和指导
- 考虑使用更专业的模型

## 参考资源

- [OpenAI Model Comparison](https://platform.openai.com/docs/models)
- [OpenAI Pricing](https://openai.com/api/pricing/)
- [GPT-4o Documentation](https://platform.openai.com/docs/guides/gpt-4o)

